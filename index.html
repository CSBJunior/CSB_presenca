<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSB Júnior - Coleta de Presença</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon.png">

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => console.log('SW erro:', err));
      });
    }
  </script>

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(180deg, #d9e5ff 0%, #f3f6ff 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding-top: 130px;
    }
    .topo {
      position: fixed; top: 0; width: 100%; text-align: center;
      background: rgba(255,255,255,0.7); backdrop-filter: blur(6px); padding: 15px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 10;
    }
    .titulo { color: #0b1b5e; font-size: clamp(20px,4.5vw,28px); font-weight: bold; margin: 0; line-height:1.3;}
    .subtitulo { color: #20337e; font-size: clamp(16px,3.5vw,20px); margin:4px 0 0 0; }
    h1 { color: #0b1b5e; font-size: clamp(20px,5vw,26px); margin-bottom:20px; text-align:center; }
    select {
      padding: 14px; font-size: 16px; border-radius: 10px; border: 1px solid #ccc;
      width: 90%; max-width: 320px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center; margin-bottom:15px;
    }
    .botoes { display:flex; flex-direction:column; gap:10px; width:90%; max-width:320px; }
    button {
      padding: 14px; background-color:#0b1b5e; color:white; border:none; border-radius:10px;
      font-size:17px; cursor:pointer; box-shadow:0 3px 8px rgba(0,0,0,0.2); transition:0.2s;
    }
    button:hover { background-color:#122e7b; transform:scale(1.02); }
    #mensagem {
      margin-top:25px; font-weight:bold; color:#0b1b5e; text-align:center;
      background: rgba(255,255,255,0.85); padding:10px 16px; border-radius:8px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1); width:90%; max-width:340px;
    }
  </style>
</head>
<body>
  <div class="topo">
    <h2 class="titulo">CSB Júnior</h2>
    <p class="subtitulo">Coleta de Presença</p>
  </div>

  <h1>Selecione seu nome:</h1>

  <select id="nome">
    <option value="">-- Escolha seu nome --</option>
    <option>Anelise</option>
    <option>Beatriz</option>
    <option>Eduardo</option>
    <option>Fernanda</option>
    <option>Franciele</option>
    <option>Gabriel S.</option>
    <option>Gabriela</option>
    <option>Georgia</option>
    <option>Giovani</option>
    <option>Giulia</option>
    <option>Isabela F.</option>
    <option>Isabele</option>
    <option>João</option>
    <option>Julia I.</option>
    <option>Lara</option>
    <option>Laura</option>
    <option>Luanne</option>
    <option>Lucas L.</option>
    <option>Lucas M.</option>
    <option>Lucas O.</option>
    <option>Luiza</option>
    <option>Lupetti</option>
    <option>Manuela</option>
    <option>Marina</option>
    <option>Mayara</option>
    <option>Nicole</option>
    <option>Rafaela</option>
    <option>Thiago E.</option>
    <option>Tiago G.</option>
    <option>Vanessa</option>
    <option>Vitória N.</option>
  </select>

  <div class="botoes">
    <button onclick="registrarPresenca('RG')">RG</button>
    <button onclick="registrarPresenca('Reunião de Projetos')">Reunião de Projetos</button>
    <button onclick="registrarPresenca('Reunião de Comercial')">Reunião de Comercial</button>
    <button onclick="registrarPresenca('Reunião de Gestão')">Reunião de Gestão</button>
  </div>

  <div id="mensagem"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyZ31zb-QRdK5LzkLNGDRQ1qRa0CVgCWu0KRymJs9nmU4qW9yBJb_oGNCSnxBToOWO3ig/exec";

    function showMensagem(text, color="black") {
      const m = document.getElementById("mensagem");
      m.textContent = text;
      m.style.color = color;
    }

    async function registrarPresenca(evento) {
      const nome = document.getElementById("nome").value;
      if (!nome) {
        showMensagem("⚠️ Por favor, selecione seu nome.", "red");
        return;
      }

      // Mostra feedback visível imediatamente:
      showMensagem(`⏳ Registrando presença de ${nome} em "${evento}"...`, "#0b1b5e");

      // Cria os dois corpos: formEncoded e jsonBody
      const formBody = new URLSearchParams({ nome: nome, evento: evento }).toString();
      const jsonBody = JSON.stringify({ nome: nome, evento: evento });

      // 1) Tenta enviar x-www-form-urlencoded (Apps Script costuma aceitar)
      // 2) Em seguida tenta enviar JSON como fallback (Apps Script também vai tratar)
      // Faz as duas requisições em sequência (não duplicará se o servidor gravar duas vezes: o log vai ajudar a checar)
      try {
        // Primeiro: form-encoded
        await fetch(scriptURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: formBody,
          cache: "no-store"
        });

        // Segundo: JSON (fallback silencioso)
        await fetch(scriptURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json;charset=UTF-8' },
          body: jsonBody,
          cache: "no-store"
        });

        // Mostra sucesso (ainda que o Apps Script possa demorar para gravar na planilha,
        // pelo menos o envio já foi disparado)
        showMensagem(`✅ Presença de ${nome} registrada em "${evento}"!`, "green");
        setTimeout(() => showMensagem(""), 4000);
      } catch (err) {
        console.error(err);
        showMensagem("❌ Erro ao registrar presença.", "red");
      }
    }
  </script>
</body>
</html>
